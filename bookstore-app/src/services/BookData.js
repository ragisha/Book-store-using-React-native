// let data=[
//     {id:'1', name:"Billy", title:"Billy Mini Monster", author: "Zanna Davidson" ,                year:1983, buy:"$10" , image:'Book1.jpg'},
//     {id:'2', name:"Story Book", title:"Write Your Own Story", author: "R.K. Narayan" ,          year:1978, buy:"$12" , image:'Book2.jpg'},
//     {id:'3', name:"100 Paper", title:"Dragons to fold & fly", author: "Vikram Seth" ,            year:1999, buy:"$15" , image:'Book3.jpg'},
//     {id:'4', name:"Biggest Fastest", title:"Biggest Fastest Tallest", author: "Anita Desa" ,     year:2010, buy:"$20" , image:'Book4.jpg'},
//     {id:'5', name:"First English", title:"First Illustrated English", author: "Zanna Davidson" , year:1988, buy:"$23" , image:'Book5.jpg'},
//     {id:'6', name:"Shark", title:"The Shark Caller", author: "Anita Desa" ,                     year:1976, buy:"$18" , image:'Book6.jpg'},
//     {id:'7', name:"Poppy Lamb", title:"Poppy and Sam Lamp", author: "R.K. Narayan" ,year:1985, buy:"$16" , image:'Book7.jpg'},
//     {id:'8', name:"Springtime", title:"First Colourig Springtimer", author: "Zanna Davidson" ,   year:1990, buy:"$13" , image:'Book8.jpg'},
//     {id:'9', name:"Spanish", title:"Spanish for Beginners", author: "Vikram Seth" ,             year:2000, buy:"$19" , image:'Book9.jpg'},
//     {id:'10', name:"Fat cat", title:"Fat cat on me", author:"Anita Desa",                        year:2013, buy:"$5" , image:'Book10.jpg'},
//     {id:'11', name:"Animals", title:"FingureSprint Animals", author:"Zanna Davidson",year:1983, buy:"$17" , image:'Book11.jpg'},
//     {id:'12', name:"Maths", title:"Maths Scribble Book", author:"R.K. Narayan",                 year:1985, buy:"$20" , image:'Book12.jpg'},
//     {id:'13', name:"Our Planet", title:"Looking After our Planet", author:"Anita Desan",         year:1991, buy:"$4" , image:'Book13.jpg'},
//     {id:'14', name:"Sleeping Princes", title:"The Sleeping Princes", author:"Zanna Davidson", year:1980, buy:"$10" , image:'Book14.jpg'},
//     {id:'15', name:"Book Brain", title:"Book or the Brain", author:"Vikram Seth",                year:1981, buy:"$15" , image:'Book15.jpg'},
//     {id:'16', name:"Unhurry", title:"The Unhurry Book", author:"Anita Desa",                     year:1999, buy:"$12" , image:'Book16.jpg'},
//     {id:'17', name:"Infinity", title:"The Infinity Files", author:"R.K. Narayan",                year:2005, buy:"$18" , image:'Book17.jpg'},
//     {id:'18', name:"Stone Age", title:"24 Hours in stone Age", author:"Zanna Davidson",          year:1990, buy:"$20" , image:'Book18.jpg'},
//     {id:'19', name:"Bunny", title:"That's not my Bunnyr", author:"Anita Desa", year:1985, buy:"$16" , image:'Book19.jpg'},
//     {id:'20', name:"Pig", title:"Dont tickle the Pig", author:"Vikram Seth",                     year:1989, buy:"$11" , image:'Book20.jpg'},
//     {id:'21', name:"Reading", title:"Ready for Reading", author:"Zanna Davidson",               year:1995, buy:"$14" , image:'Book21.jpg'},
//     {id:'22', name:"Virus", title:"What is Virus", author:"R.K. Narayan",  year:1980, buy:"$16" , image:'Book22.jpg'}]
let books=[
  {id:'1', name:"Billy", title:"Billy Mini Monster", author:"Kalki",publisher:"Indus House",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781474978439_cover_image.jpg"},
  {id:'2', name:"Story Book", title:"Write Your Own Story", author:"Kalki",publisher:"Indus House",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781409523352_cover_image.jpg"},
  {id:'3', name:"100 Paper", title:"Dragons to fold & fly", author:"Kalki",publisher:"Indus House",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781409598596_cover_image.jpg"},
  {id:'4', name:"Biggest Fastest", title:"Biggest Fastest Tallest", author:"Kalki",publisher:"Indus House",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781474950855_cover_image.jpg"},
  {id:'5', name:"First English", title:"First Illustrated English", author:"Kalki",publisher:"Indus House",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781474941044_cover_image.jpg"},
  {id:'6', name:"Shark", title:"The Shark Caller",  author:"Kalki",publisher:"Indus House",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781474966849_cover_image.jpg"},
  {id:'7', name:"Poppy Lamb", title:"Poppy and Sam Lamp", author:"Kalki",publisher:"Indus House",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781474981354_cover_image.jpg"},
  {id:'8', name:"Springtime", title:"First Colourig Springtimer", author:"Kalki",publisher:"Indus House",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781474985420_cover_image.jpg"},
  {id:'9', name:"Spanish", title:"Spanish for Beginners", author:"Takur",publisher:"Indus House",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781409509202_cover_image.jpg"},
  {id:'10', name:"Fat cat", title:"Fat cat on me", author:"Takur",publisher:"Indus House",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781409509233_cover_image.jpg"},
  {id:'11', name:"Animals", title:"FingureSprint Animals", author:"Takur",publisher:"Penguie",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781474914338_cover_image.jpg"},
  {id:'12', name:"Maths", title:"Maths Scribble Book", author:"Takur",publisher:"Penguie",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781474959940_cover_image.jpg"},
  {id:'13', name:"Our Planet", title:"Looking After our Planet",author:"Takur",publisher:"Penguie",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781474968942_cover_image.jpg"},
  {id:'14', name:"Sleeping Princes", title:"The Sleeping Princes", author:"Takur",publisher:"Penguie",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781474969802_cover_image.jpg"},
  {id:'15', name:"Book Brain", title:"Book or the Brain",author:"Takur",publisher:"Penguie",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781474950589_cover_image.jpg"},
  {id:'16', name:"Unhurry", title:"The Unhurry Book", author:"Takur",publisher:"Penguie",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781474970495_cover_image.jpg"},
  {id:'17', name:"Infinity", title:"The Infinity Files",author:"Anna",publisher:"Penguie",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781474972208_cover_image.jpg"},
  {id:'18', name:"Stone Age", title:"24 Hours in stone Age",author:"Anna",publisher:"Penguie",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781474977111_cover_image.jpg"},
  {id:'19', name:"Bunny", title:"That's not my Bunny", author:"Anna",publisher:"Penguie",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9780746066928_cover_image.jpg"},
  {id:'20', name:"Pig", title:"Dont tickle the Pig",  author:"Anna",publisher:"Penguie",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781474981323_cover_image.jpg"},
  {id:'21', name:"Reading", title:"Ready for Reading", author:"Anna",publisher:"Penguie",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781474986694_cover_image.jpg"},
  {id:'22', name:"Virus", title:"What is Virus", author:"Anna",publisher:"Penguie",isbn:"A7yZ4b",year:"2019",buy:"10",image:"https://training.pyther.com/yara/15-day/07-BookStore/books/9781474991513_cover_image.jpg"}];
import { openDatabase } from 'react-native-sqlite-storage';
var customerDB = openDatabase({ name: 'CustomerDB.db' });
setTimeout(function(){
    customerDB.transaction(function (txn) {
        txn.executeSql(
        "SELECT name FROM sqlite_master WHERE type='table' AND name='books'",
        [],
        function (txn, res) {
            console.log('item:customerDB:::', res.rows.length);
            if (res.rows.length == 0) {
            txn.executeSql('DROP TABLE IF EXISTS books', []);
            txn.executeSql(
                'CREATE TABLE IF NOT EXISTS books(id INTEGER PRIMARY KEY AUTOINCREMENT, name VARCHAR(20),title VARCHAR(20),author VARCHAR(20),publisher VARCHAR(20),isbn VARCHAR(20),year VARCHAR(10),buy VARCHAR(20), image VARCHAR(20))',
                []
            );
            }
        }
        );
    });
},1000);

//promise or callback
export var  getBooks = () => {
    var sql = "select * from books";
    return new Promise(function(resolve, reject) {
        customerDB.transaction(function (txn) {
            txn.executeSql(sql,[],
              function (txn, res) {
                  let records = [];
                  for(let i = 0; i< res.rows.length;i++){
                    records.push(res.rows.item(i))
                  }
                records.json = () =>{res};
                console.log('result:', res);
                resolve(records);
              },
              function(error){
                console.log('error:', error);
              }
            );
          });
      });
};

export const addBook = (book) =>{
    console.log("DB addBook.."+JSON.stringify(book));
    var sql = "INSERT INTO books (name, title, author,publisher,isbn, year,buy,image) VALUES ('"+book.name+"', '"+book.title+"', '"+book.author+"','"+book.publisher+"','"+book.isbn+"','"+book.year+"', '"+book.buy+"', '"+book.image+"')";
    return new Promise(function(resolve, reject) {
        customerDB.transaction(function (txn) {
            txn.executeSql(sql,
             // "INSERT INTO customers (name, email, phone, address) VALUES ("+customer.name+", "+customer.email+", "+customer.phone+","+customer.address+")",
              [],
              function (txn, res) {
                res.json = () =>{res};
                resolve(res);
              },
              function(error){
                console.log('error:', error);
              }
            );
          });
      });
}

export const deleteBooks = (id) =>{
    console.log("DB deleteCustomer.. "+id.id);
    var sql = "DELETE FROM books WHERE id = '"+id.id+"'";
    return new Promise(function(resolve, reject) {
        customerDB.transaction(function (txn) {
            txn.executeSql(sql,
              [],
              function (txn, res) {
                res.json = () =>{res};
                resolve(res);
              },
              function(error){
                console.log('error:', error);
              }
            );
          });
      });
}

export const updateBook = (book) => {
    console.log("DB updateCustomer.."+JSON.stringify(book));
    var sql = "UPDATE books SET name = '"+book.name+"',title = '"+book.title+"',author = '"+book.author+"',publisher = '"+book.publisher+"',isbn = '"+book.isbn+"',year ='"+book.year+"',buy = '"+book.buy+"',image = '"+book.image+"' WHERE id = '"+book.id+"'";
    return new Promise(function(resolve, reject) {
        customerDB.transaction(function (txn) {
            txn.executeSql(sql,
              [],
              function (txn, res) {
                res.json = () =>{res};
                resolve(res);
              },
              function(error){
                console.log('error:', error);
              }
            );
          });
      });
}

export const getBookById = (id) =>{
    console.log('sending info of id '+ id);
    var sql = "select * from books where id ='"+id+"'";
    return new Promise(function(resolve, reject) {
        customerDB.transaction(function (txn) {
            txn.executeSql(sql,[],
              function (txn, res) {
                  let records = [];
                  for(let i = 0; i< res.rows.length;i++){
                    records.push(res.rows.item(i))
                  }
                records.json = () =>{res};
                console.log('result:', records);
                resolve(records[0]);
              },
              function(error){
                console.log('error:', error);
              }
            );
          });
      });
}

export const searchBook = (searchText) =>{
  console.log("DB searchBook.."+searchText);
  var sql = "select * from books where lower(title) like '%"+searchText+"%'";
  return new Promise(function(resolve, reject) {
      customerDB.transaction(function (txn) {
          txn.executeSql(sql,[],
            function (txn, res) {
              let records = [];
                  for(let i = 0; i< res.rows.length;i++){
                    records.push(res.rows.item(i))
                  }
                records.json = () =>{res};
                console.log('result:', records);
                resolve(records);
            },
            function(error){
              console.log('error:', error);
            }
          );
        });
    });
}